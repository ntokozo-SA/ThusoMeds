<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Mood Tracker - Pregnancy Wellness</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Mood Tracker Specific Styles */
    .mood-tracker-container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: linear-gradient(135deg, #fce4ec, #f8bbd9);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .mood-tracker-header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #e91e63, #f06292);
      color: white;
      border-radius: 12px;
    }

    .mood-tracker-header h1 {
      margin: 0;
      font-size: 2.2em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .mood-tracker-header p {
      margin: 10px 0 0 0;
      font-size: 1.1em;
      opacity: 0.9;
    }

    .current-date {
      text-align: center;
      font-size: 1.2em;
      color: #666;
      margin-bottom: 25px;
      font-weight: bold;
    }

    .mood-selection {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .mood-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .mood-option {
      text-align: center;
      padding: 15px;
      border: 3px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }

    .mood-option:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .mood-option.selected {
      border-color: #e91e63;
      background: linear-gradient(135deg, #fce4ec, #f8bbd9);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
    }

    .mood-emoji {
      font-size: 2.5em;
      margin-bottom: 8px;
      display: block;
    }

    .mood-label {
      font-weight: bold;
      color: #333;
      font-size: 0.9em;
    }

    .mood-description {
      font-size: 0.8em;
      color: #666;
      margin-top: 4px;
    }

    .mood-notes {
      margin-top: 20px;
    }

    .mood-notes label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }

    .mood-notes textarea {
      width: 100%;
      min-height: 100px;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      resize: vertical;
      font-family: inherit;
    }

    .mood-notes textarea:focus {
      outline: none;
      border-color: #e91e63;
      box-shadow: 0 0 8px rgba(233, 30, 99, 0.3);
    }

    .symptoms-section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .symptoms-section h3 {
      color: #e91e63;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .symptoms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .symptom-item {
      display: flex;
      align-items: center;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .symptom-item input[type="checkbox"] {
      margin-right: 8px;
      transform: scale(1.2);
    }

    .symptom-item label {
      font-size: 0.9em;
      cursor: pointer;
      flex: 1;
    }

    .submit-mood {
      text-align: center;
      margin-top: 25px;
    }

    .submit-btn {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
    }

    .submit-btn:hover {
      background: linear-gradient(135deg, #388e3c, #4caf50);
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(76, 175, 80, 0.4);
    }

    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .mood-history {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .mood-history h3 {
      color: #e91e63;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .mood-entry {
      display: flex;
      align-items: center;
      padding: 12px;
      margin-bottom: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #e91e63;
    }

    .mood-entry-date {
      font-weight: bold;
      color: #333;
      min-width: 120px;
    }

    .mood-entry-emoji {
      font-size: 1.5em;
      margin: 0 15px;
    }

    .mood-entry-notes {
      flex: 1;
      color: #666;
      font-size: 0.9em;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #c3e6cb;
      display: none;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #f5c6cb;
      display: none;
    }

    .pregnancy-tips {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border: 2px solid #ffb74d;
    }

    .pregnancy-tips h3 {
      color: #f57c00;
      margin-bottom: 15px;
    }

    .tip-item {
      margin-bottom: 10px;
      padding: 8px;
      background: rgba(255,255,255,0.7);
      border-radius: 6px;
      font-size: 0.9em;
    }

    .refresh-btn {
      background: linear-gradient(135deg, #2196f3, #42a5f5);
      color: white;
      border: none;
      padding: 8px 15px;
      font-size: 0.9em;
      font-weight: bold;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
    }

    .refresh-btn:hover {
      background: linear-gradient(135deg, #1976d2, #2196f3);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
    }

    .refresh-btn:active {
      transform: translateY(0);
    }

    .refresh-btn i {
      margin-right: 5px;
    }

    @media (max-width: 768px) {
      .mood-tracker-container {
        margin: 10px;
        padding: 15px;
      }
      
      .mood-options {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .mood-tracker-header h1 {
        font-size: 1.8em;
      }
    }
  </style>
</head>
<body>
  <div class="mood-tracker-container">
    <div class="mood-tracker-header">
      <h1><i class="fas fa-heart"></i> Daily Mood Tracker</h1>
      <p>Track your emotional wellbeing during pregnancy</p>
    </div>

    <div class="current-date" id="current-date"></div>

    <div id="success-message" class="success-message">
      <i class="fas fa-check-circle"></i> <strong>Great!</strong> Your mood has been recorded successfully.
    </div>

    <div id="error-message" class="error-message">
      <i class="fas fa-exclamation-triangle"></i> <strong>Error!</strong> <span id="error-text"></span>
    </div>

    <div class="mood-selection">
      <h3 style="color: #e91e63; margin-bottom: 20px;">How are you feeling today?</h3>
      <div class="mood-options">
        <div class="mood-option" data-mood="excellent">
          <span class="mood-emoji">üòä</span>
          <div class="mood-label">Excellent</div>
          <div class="mood-description">Feeling great!</div>
        </div>
        <div class="mood-option" data-mood="good">
          <span class="mood-emoji">üòå</span>
          <div class="mood-label">Good</div>
          <div class="mood-description">Feeling well</div>
        </div>
        <div class="mood-option" data-mood="okay">
          <span class="mood-emoji">üòê</span>
          <div class="mood-label">Okay</div>
          <div class="mood-description">Neutral</div>
        </div>
        <div class="mood-option" data-mood="anxious">
          <span class="mood-emoji">üò∞</span>
          <div class="mood-label">Anxious</div>
          <div class="mood-description">Feeling worried</div>
        </div>
        <div class="mood-option" data-mood="sad">
          <span class="mood-emoji">üò¢</span>
          <div class="mood-label">Sad</div>
          <div class="mood-description">Feeling down</div>
        </div>
        <div class="mood-option" data-mood="overwhelmed">
          <span class="mood-emoji">üòµ</span>
          <div class="mood-label">Overwhelmed</div>
          <div class="mood-description">Too much to handle</div>
        </div>
      </div>

      <div class="mood-notes">
        <label for="mood-notes">Additional notes (optional):</label>
        <textarea id="mood-notes" placeholder="Share what's on your mind today..."></textarea>
      </div>
    </div>

    <div class="symptoms-section">
      <h3>Common Pregnancy Symptoms Today:</h3>
      <div class="symptoms-grid">
        <div class="symptom-item">
          <input type="checkbox" id="nausea" name="symptoms" value="nausea">
          <label for="nausea">Nausea/Morning Sickness</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="fatigue" name="symptoms" value="fatigue">
          <label for="fatigue">Fatigue</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="back-pain" name="symptoms" value="back-pain">
          <label for="back-pain">Back Pain</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="mood-swings" name="symptoms" value="mood-swings">
          <label for="mood-swings">Mood Swings</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="cravings" name="symptoms" value="cravings">
          <label for="cravings">Food Cravings</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="heartburn" name="symptoms" value="heartburn">
          <label for="heartburn">Heartburn</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="swelling" name="symptoms" value="swelling">
          <label for="swelling">Swelling</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="insomnia" name="symptoms" value="insomnia">
          <label for="insomnia">Sleep Issues</label>
        </div>
        <div class="symptom-item">
          <input type="checkbox" id="none" name="symptoms" value="none">
          <label for="none">None of the above</label>
        </div>
      </div>
    </div>

    <div class="submit-mood">
      <button type="button" id="submit-mood-btn" class="submit-btn">
        <i class="fas fa-save"></i> Save Today's Mood
      </button>
    </div>

    <div class="mood-history">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3 style="margin: 0;"><i class="fas fa-history"></i> Recent Mood History</h3>
        <button type="button" id="refresh-history-btn" class="refresh-btn" title="Refresh mood history">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>
      <div id="mood-history-list">
        <!-- Mood history will be populated here -->
      </div>
    </div>

    <div class="pregnancy-tips">
      <h3><i class="fas fa-lightbulb"></i> Daily Wellness Tips</h3>
      <div class="tip-item">
        <strong>Stay Hydrated:</strong> Drink plenty of water throughout the day.
      </div>
      <div class="tip-item">
        <strong>Gentle Exercise:</strong> Take short walks or do prenatal yoga.
      </div>
      <div class="tip-item">
        <strong>Rest Well:</strong> Get adequate sleep and take naps when needed.
      </div>
      <div class="tip-item">
        <strong>Connect:</strong> Talk to your partner, friends, or healthcare provider about your feelings.
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set current date
      const currentDate = new Date();
      const dateOptions = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      document.getElementById('current-date').textContent = currentDate.toLocaleDateString('en-US', dateOptions);

      // Mood selection functionality
      const moodOptions = document.querySelectorAll('.mood-option');
      let selectedMood = null;

      moodOptions.forEach(option => {
        option.addEventListener('click', function() {
          // Remove selected class from all options
          moodOptions.forEach(opt => opt.classList.remove('selected'));
          
          // Add selected class to clicked option
          this.classList.add('selected');
          selectedMood = this.dataset.mood;
        });
      });

      // Submit mood functionality
      const submitBtn = document.getElementById('submit-mood-btn');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');

      submitBtn.addEventListener('click', async function() {
        // Hide previous messages
        successMessage.style.display = 'none';
        errorMessage.style.display = 'none';

        // Validate mood selection
        if (!selectedMood) {
          errorText.textContent = 'Please select how you are feeling today.';
          errorMessage.style.display = 'block';
          return;
        }

        // Get selected symptoms
        const selectedSymptoms = [];
        const symptomCheckboxes = document.querySelectorAll('input[name="symptoms"]:checked');
        symptomCheckboxes.forEach(checkbox => {
          selectedSymptoms.push(checkbox.value);
        });

        // Get mood notes
        const moodNotes = document.getElementById('mood-notes').value.trim();

        // Prepare data
        const moodData = {
          date: currentDate.toISOString().split('T')[0],
          mood: selectedMood,
          notes: moodNotes,
          symptoms: selectedSymptoms
        };

        // Disable submit button
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

        try {
          // Submit to backend (you can modify this endpoint as needed)
          const response = await fetch('http://localhost:5000/mood-tracker', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(moodData)
          });

          if (response.ok) {
            // Show success message
            successMessage.style.display = 'block';
            
            // Add to local history
            addMoodToHistory(moodData);
            
            // Reset form
            resetForm();
            
            // Scroll to top to show success message
            window.scrollTo({ top: 0, behavior: 'smooth' });
          } else {
            const result = await response.json();
            throw new Error(result.error || 'Failed to save mood data');
          }
        } catch (error) {
          console.error('Error:', error);
          errorText.textContent = error.message || 'Failed to save mood data. Please try again.';
          errorMessage.style.display = 'block';
        } finally {
          // Re-enable submit button
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Today\'s Mood';
        }
      });

      // Reset form function
      function resetForm() {
        moodOptions.forEach(opt => opt.classList.remove('selected'));
        selectedMood = null;
        document.getElementById('mood-notes').value = '';
        document.querySelectorAll('input[name="symptoms"]').forEach(checkbox => {
          checkbox.checked = false;
        });
      }

      // Add mood to history function
      function addMoodToHistory(moodData) {
        const historyList = document.getElementById('mood-history-list');
        
        // If the history list shows "no history" message, clear it
        if (historyList.innerHTML.includes('No mood history yet')) {
          historyList.innerHTML = '';
        }
        
        // Create a temporary container for the new entry
        const tempContainer = document.createElement('div');
        displayMoodEntry(moodData, tempContainer);
        
        // Insert at the beginning of the history list
        const newEntry = tempContainer.firstChild;
        historyList.insertBefore(newEntry, historyList.firstChild);

        // Limit history to 10 entries
        const entries = historyList.querySelectorAll('.mood-entry');
        if (entries.length > 10) {
          entries[entries.length - 1].remove();
        }
      }

      // Load existing mood history from backend
      loadMoodHistory();

      // Add refresh button functionality
      const refreshBtn = document.getElementById('refresh-history-btn');
      refreshBtn.addEventListener('click', function() {
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        this.disabled = true;
        
        loadMoodHistory().then(() => {
          this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
          this.disabled = false;
        }).catch(() => {
          this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
          this.disabled = false;
        });
      });

      async function loadMoodHistory() {
        const historyList = document.getElementById('mood-history-list');
        
        try {
          // Fetch mood entries from backend (last 30 entries)
          const response = await fetch('http://localhost:5000/mood-tracker?limit=30');
          
          if (response.ok) {
            const data = await response.json();
            const moodEntries = data.mood_entries || [];
            
            if (moodEntries.length === 0) {
              historyList.innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">No mood history yet. Start tracking your daily mood!</p>';
              return;
            }
            
            // Clear existing content
            historyList.innerHTML = '';
            
            // Display mood entries
            moodEntries.forEach(entry => {
              displayMoodEntry(entry, historyList);
            });
            
          } else {
            console.error('Failed to load mood history:', response.statusText);
            historyList.innerHTML = '<p style="text-align: center; color: #dc3545; font-style: italic;">Failed to load mood history. Please try again later.</p>';
          }
        } catch (error) {
          console.error('Error loading mood history:', error);
          historyList.innerHTML = '<p style="text-align: center; color: #dc3545; font-style: italic;">Error loading mood history. Please check your connection.</p>';
        }
      }

      function displayMoodEntry(entry, container) {
        const moodEntry = document.createElement('div');
        moodEntry.className = 'mood-entry';
        
        const moodEmojis = {
          'excellent': 'üòä',
          'good': 'üòå',
          'okay': 'üòê',
          'anxious': 'üò∞',
          'sad': 'üò¢',
          'overwhelmed': 'üòµ'
        };

        const moodLabels = {
          'excellent': 'Excellent',
          'good': 'Good',
          'okay': 'Okay',
          'anxious': 'Anxious',
          'sad': 'Sad',
          'overwhelmed': 'Overwhelmed'
        };

        // Parse date and format it
        const entryDate = new Date(entry.date);
        const formattedDate = entryDate.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric',
          year: entryDate.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
        });

        // Parse symptoms if they exist
        let symptomsText = '';
        if (entry.symptoms && entry.symptoms.length > 0) {
          symptomsText = `<br><small style="color: #888;">Symptoms: ${entry.symptoms.join(', ')}</small>`;
        }

        moodEntry.innerHTML = `
          <div class="mood-entry-date">${formattedDate}</div>
          <div class="mood-entry-emoji">${moodEmojis[entry.mood] || 'üòê'}</div>
          <div class="mood-entry-notes">
            <strong>${moodLabels[entry.mood] || entry.mood}</strong>
            ${entry.notes ? ' - ' + entry.notes : ''}
            ${symptomsText}
          </div>
        `;

        container.appendChild(moodEntry);
      }
    });
  </script>
</body>
</html>
